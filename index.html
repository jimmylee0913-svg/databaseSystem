<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥¤ é£²æ–™åº—ç·šä¸Šé»é¤ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾© CSS - è®“æ‡¸æµ®è³¼ç‰©è»Šçœ‹èµ·ä¾†æ›´å°ˆæ¥­ */
        .cart-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <header class="bg-white shadow-md p-4 sticky top-0 z-10">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold text-pink-600">Bubble Tea King</h1>
        
        <div class="relative w-1/3 min-w-[150px]">
            <input 
                type="text" 
                id="search-input" 
                placeholder="æœå°‹é£²å“åç¨±..." 
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:ring-pink-500 focus:border-pink-500 transition duration-150"
            >
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        </div>
    </div>
    </header>

    <div id="customization-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden flex items-center justify-center z-50 transition-opacity duration-300">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-6 transform transition-transform duration-300 scale-95 opacity-0" id="modal-content">
        
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <h3 class="text-2xl font-bold text-pink-600">å®¢è£½åŒ–æ‚¨çš„ <span id="modal-item-name">é£²å“</span></h3>
            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="customization-form" class="space-y-6">
            <div>
                <label class="block text-lg font-semibold mb-2">ç”œåº¦ (å¿…é¸)</label>
                <div class="flex flex-wrap gap-2" id="sweetness-options">
                    </div>
            </div>

            <div>
                <label class="block text-lg font-semibold mb-2">å†°å¡Š (å¿…é¸)</label>
                <div class="flex flex-wrap gap-2" id="ice-options">
                    </div>
            </div>

            <div>
                <label class="block text-lg font-semibold mb-2">åŠ æ–™å€ (é¸å¡«)</label>
                <div class="space-y-2" id="topping-options">
                    </div>
            </div>
            
            <div class="border-t pt-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <button type="button" id="qty-minus" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full h-8 w-8 flex items-center justify-center font-bold">-</button>
                    <span id="current-quantity" class="text-xl font-bold">1</span>
                    <button type="button" id="qty-plus" class="bg-gray-200 hover:bg-gray-300 p-2 rounded-full h-8 w-8 flex items-center justify-center font-bold">+</button>
                </div>
                
                <button type="submit" class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-200" id="modal-add-to-cart-btn">
                    åŠ å…¥è³¼ç‰©è»Š ($<span id="modal-current-price">0</span>)
                </button>
            </div>
        </form>

    </div>
</div>

    <main class="max-w-4xl mx-auto p-4 pt-6">
        
        <div class="bg-indigo-50 p-6 rounded-xl shadow-md mb-6">
            <h2 class="text-xl font-bold mb-3 text-indigo-700">ğŸ” è¨‚å–®æŸ¥è©¢</h2>
            <div class="flex space-x-2">
                <input 
                    type="tel" 
                    id="phone-query-input" 
                    placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿå¾Œä¸‰ç¢¼ (3ä½æ•¸å­—)" 
                    class="w-full max-w-xs p-2 border rounded-lg focus:border-indigo-500"
                    maxlength="3" 
                    pattern="\d{3}" 
                    inputmode="numeric"
                >
                <button id="query-order-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                    æŸ¥è©¢
                </button>
            </div>
            <div id="query-result" class="mt-4 space-y-3 text-gray-700">
                </div>
        </div>
        <div id="category-tabs" class="flex overflow-x-auto whitespace-nowrap space-x-3 pb-3 mb-6 border-b border-gray-200">
            <button class="category-btn py-2 px-4 rounded-full text-sm font-medium bg-pink-600 text-white shadow-lg transition duration-150" data-category="all">ğŸ”¥ äººæ°£å¿…é»</button>
            <button class="category-btn py-2 px-4 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition duration-150" data-category="milk-tea">ğŸ¥¤ ç¶“å…¸å¥¶èŒ¶</button>
            <button class="category-btn py-2 px-4 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition duration-150" data-category="fruit-tea">ğŸ¥ æ¸…æ–°æœèŒ¶</button>
            <button class="category-btn py-2 px-4 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition duration-150" data-category="seasonal">ğŸ“ å­£ç¯€é™å®š</button>
        </div>

        <h2 class="text-2xl font-bold mb-4 text-gray-800">æ‰€æœ‰é£²å“</h2>
        <div id="menu-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </main>

    <div class="cart-float">
        <button id="cart-float-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-full p-4 shadow-2xl transition duration-300 transform hover:scale-105">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span id="cart-item-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
        </button>
    </div>

    <script>
        // --- èœå–®è³‡æ–™çµæ§‹ ---
const menuItems = [
    { id: 1, name: 'çç å¥¶èŒ¶', price: 60, category: 'milk-tea', isPopular: true, image: 'milkTea.png' },
    { id: 2, name: 'å››å­£æ˜¥é’èŒ¶', price: 40, category: 'fruit-tea', isPopular: true, image: 'Tea.jpg' },
    { id: 3, name: 'é®®æ¦¨æª¸æª¬æ±', price: 55, category: 'fruit-tea', isPopular: false, image: 'lemonJuice.jpg' },
    { id: 4, name: 'è‰è“å„ªæ ¼å†°æ²™', price: 85, category: 'seasonal', isPopular: false, image: 'strawberrySmoothie.jpg' },
];

const customizationOptions = {
    sweetness: [
        { label: 'æ­£å¸¸ç³–', value: 'normal', price: 0 },
        { label: 'å°‘ç³– (7åˆ†)', value: 'less', price: 0 },
        { label: 'åŠç³– (5åˆ†)', value: 'half', price: 0 },
        { label: 'å¾®ç³– (3åˆ†)', value: 'quarter', price: 0 },
        { label: 'ç„¡ç³–', value: 'free', price: 0 },
    ],
    ice: [
        { label: 'æ­£å¸¸å†°', value: 'normal', price: 0 },
        { label: 'å°‘å†°', value: 'less', price: 0 },
        { label: 'å¾®å†°', value: 'quarter', price: 0 },
        { label: 'å»å†°', value: 'free', price: 0 },
        { label: 'æº«ç†±', value: 'warm', price: 0 },
    ],
    toppings: [
        { label: 'çç ', value: 'boba', price: 10 },
        { label: 'æ¤°æœ', value: 'coconut', price: 10 },
        { label: 'å¥¶è“‹', value: 'creme', price: 20 },
    ]
};

// --- Modal ç›¸é—œå…¨åŸŸè®Šæ•¸ ---
const modal = document.getElementById('customization-modal');
const modalContent = document.getElementById('modal-content');
const modalItemName = document.getElementById('modal-item-name');
const modalCurrentPrice = document.getElementById('modal-current-price');
const currentQuantityEl = document.getElementById('current-quantity');
const form = document.getElementById('customization-form');

let currentItem = null; // ç•¶å‰æ­£åœ¨å®¢è£½åŒ–çš„é£²å“å°è±¡
let currentBasePrice = 0; // ç•¶å‰é£²å“çš„åŸºç¤åƒ¹æ ¼
let currentQty = 1; // ç•¶å‰é£²å“çš„æ•¸é‡

let cart = []; // è³¼ç‰©è»Šé™£åˆ—
const menuList = document.getElementById('menu-list');
const cartItemCount = document.getElementById('cart-item-count');
const searchInput = document.getElementById('search-input');

// --- æŸ¥è©¢è¨‚å–®ç›¸é—œå…ƒç´  ---
const phoneQueryInput = document.getElementById('phone-query-input');
const queryOrderBtn = document.getElementById('query-order-btn');
const queryResultDiv = document.getElementById('query-result');


// --- å‡½å¼ï¼šæ¸²æŸ“èœå–®åˆ—è¡¨ ---
function renderMenu(itemsToRender) {
    menuList.innerHTML = ''; // æ¸…ç©ºç¾æœ‰åˆ—è¡¨

    itemsToRender.forEach(item => {
        const itemCard = document.createElement('div');
        itemCard.className = 'bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden';
        
        // æ§‹å»ºå¡ç‰‡ HTML å…§å®¹
        itemCard.innerHTML = `
            <img src="${item.image}" alt="${item.name}" class="w-full h-40 object-cover">
            <div class="p-4">
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-semibold text-gray-800">${item.name}</h3>
                    ${item.isPopular ? '<span class="text-xs bg-red-100 text-red-800 font-medium px-2 py-0.5 rounded-full">ç†±é–€</span>' : ''}
                </div>
                <p class="text-pink-600 font-bold text-lg mt-2">$${item.price}</p>
                
                <button 
                    data-id="${item.id}"
                    class="add-to-cart-btn mt-3 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 rounded-lg transition duration-150 shadow-md">
                    + åŠ å…¥è³¼ç‰©è»Š
                </button>
            </div>
        `;
        menuList.appendChild(itemCard);
    });

    // é‡æ–°ç¶å®šã€ŒåŠ å…¥è³¼ç‰©è»Šã€æŒ‰éˆ•çš„äº‹ä»¶
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', handleAddToCart);
    });
}

// --- å‡½å¼ï¼šè™•ç†åŠ å…¥è³¼ç‰©è»Šäº‹ä»¶ ---
function handleAddToCart(event) {
    const itemId = parseInt(event.currentTarget.getAttribute('data-id'));
    const item = menuItems.find(i => i.id === itemId);

    if (item) {
        currentItem = item;
        currentBasePrice = item.price;
        currentQty = 1; // é‡è¨­æ•¸é‡
        
        // 1. é¡¯ç¤º Modal
        showCustomizationModal(item);
        
        // 2. è¼‰å…¥é¸é …
        renderOptions();
        
        // 3. æ›´æ–°åƒ¹æ ¼å’Œæ•¸é‡é¡¯ç¤º
        updateModalDisplay();
    }
}

// --- å‡½å¼ï¼šæ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º ---
function updateCartCount() {
    // é€™è£¡æˆ‘å€‘æ‡‰è©²è¨ˆç®— cart é™£åˆ—çš„ç¸½é …ç›®æ•¸ï¼Œè€Œä¸æ˜¯ç¸½æ•¸é‡ã€‚
    // å¦‚æœæ‚¨æƒ³é¡¯ç¤ºç¸½æ•¸é‡ï¼Œå¯ä»¥æ”¹æˆï¼šcart.reduce((total, item) => total + item.quantity, 0);
    cartItemCount.textContent = cart.length; 
}

// --- å‡½å¼ï¼šè™•ç†é¡åˆ¥ç¯©é¸ ---
function handleCategoryFilter(event) {
    const category = event.currentTarget.getAttribute('data-category');
    
    // é‡è¨­æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.className = 'category-btn py-2 px-4 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition duration-150';
    });
    // è¨­ç½®ç•¶å‰é¸ä¸­æŒ‰éˆ•çš„æ¨£å¼
    event.currentTarget.className = 'category-btn py-2 px-4 rounded-full text-sm font-medium bg-pink-600 text-white shadow-lg transition duration-150';

    if (category === 'all') {
        renderMenu(menuItems.filter(item => item.isPopular));
    } else {
        const filteredItems = menuItems.filter(item => item.category === category);
        renderMenu(filteredItems);
    }
}

// --- å‡½å¼ï¼šè™•ç†æœå°‹äº‹ä»¶ ---
function handleSearch() {
    const searchTerm = searchInput.value.toLowerCase().trim();

    if (searchTerm === '') {
        // æ¸…ç©ºæœå°‹å¾Œå›åˆ° "all" é¡åˆ¥çš„é¡¯ç¤º
        document.querySelector('.category-btn[data-category="all"]').click(); 
        return;
    }

    const filteredItems = menuItems.filter(item => {
        return item.name.toLowerCase().includes(searchTerm);
    });

    renderMenu(filteredItems);

    // æœå°‹å¾Œç§»é™¤é¡åˆ¥æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹ï¼Œé¿å…æ··æ·†
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.className = 'category-btn py-2 px-4 rounded-full text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 transition duration-150';
    });
}

// --- å‡½å¼ï¼šé¡¯ç¤ºå®¢è£½åŒ– Modal ---
function showCustomizationModal(item) {
    modalItemName.textContent = item.name;
    modal.classList.remove('hidden');
    // æ·»åŠ éå ´å‹•ç•«é¡
    setTimeout(() => {
        modalContent.classList.remove('opacity-0', 'scale-95');
        modalContent.classList.add('scale-100', 'opacity-100');
    }, 10);
}

// --- å‡½å¼ï¼šé—œé–‰å®¢è£½åŒ– Modal ---
function closeModal() {
    modalContent.classList.remove('scale-100', 'opacity-100');
    modalContent.classList.add('opacity-0', 'scale-95');
    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300); // é…åˆ CSS transition çµæŸæ™‚é–“
}

// --- å‡½å¼ï¼šæ¸²æŸ“å®¢è£½åŒ–é¸é … ---
function renderOptions() {
    // æª¢æŸ¥ç•¶å‰é£²å“æ˜¯å¦æ˜¯è‰è“å„ªæ ¼å†°æ²™ (æˆ–ä»»ä½•æ‚¨å®šç¾©çš„å†°æ²™/é™å®šå•†å“)
    const isSmoothie = currentItem && currentItem.name === 'è‰è“å„ªæ ¼å†°æ²™'; 
    
    document.getElementById('sweetness-options').innerHTML = renderRadioOptions('sweetness', customizationOptions.sweetness, 'normal');
    // å‘¼å«æ™‚å‚³å…¥ isSmoothie æ——æ¨™ï¼Œç”¨æ–¼æ’é™¤æº«ç†±é¸é …
    document.getElementById('ice-options').innerHTML = renderRadioOptions('ice', customizationOptions.ice, 'normal', isSmoothie); 
    document.getElementById('topping-options').innerHTML = renderCheckboxOptions('toppings', customizationOptions.toppings);

    // é‡æ–°ç¶å®šé¸é …æ”¹è®Šäº‹ä»¶ (ç”¨ä¾†å³æ™‚æ›´æ–°åƒ¹æ ¼)
    form.querySelectorAll('input').forEach(input => {
        input.addEventListener('change', updateModalDisplay);
    });
}

// è¼”åŠ©å‡½å¼ï¼šæ¸²æŸ“ Radio æŒ‰éˆ•ç¾¤çµ„ (ä¿®æ­£å¾Œ)
function renderRadioOptions(name, options, defaultVal, excludeWarm = false) {
    
    // æ ¹æ“š excludeWarm æ——æ¨™éæ¿¾é¸é …
    const filteredOptions = excludeWarm 
        ? options.filter(opt => opt.value !== 'warm')
        : options;

    return filteredOptions.map(opt => `
        <label class="flex items-center space-x-2 bg-gray-100 hover:bg-pink-100 p-3 rounded-full cursor-pointer transition duration-150">
            <input type="radio" name="${name}" value="${opt.value}" ${opt.value === defaultVal ? 'checked' : ''} class="form-radio text-pink-600">
            <span>${opt.label}</span>
        </label>
    `).join('');
}

// è¼”åŠ©å‡½å¼ï¼šæ¸²æŸ“ Checkbox ç¾¤çµ„
function renderCheckboxOptions(name, options) {
    return options.map(opt => `
        <label class="flex justify-between items-center bg-gray-100 hover:bg-pink-100 p-3 rounded-lg cursor-pointer transition duration-150">
            <div class="flex items-center space-x-2">
                <input type="checkbox" name="${name}" value="${opt.value}" data-price="${opt.price}" class="form-checkbox text-pink-600 rounded">
                <span>${opt.label} (+$${opt.price})</span>
            </div>
            
        </label>
    `).join('');
}

// --- å‡½å¼ï¼šæ›´æ–° Modal åƒ¹æ ¼å’Œæ•¸é‡é¡¯ç¤º ---
function updateModalDisplay() {
    let toppingPrice = 0;
    
    // è¨ˆç®—åŠ æ–™ç¸½åƒ¹
    form.querySelectorAll('input[name="toppings"]:checked').forEach(checkbox => {
        toppingPrice += parseInt(checkbox.getAttribute('data-price'));
    });

    const itemTotal = (currentBasePrice + toppingPrice) * currentQty;

    modalCurrentPrice.textContent = itemTotal;
    currentQuantityEl.textContent = currentQty;
}

// --- å‡½å¼ï¼šæœ€çµ‚å°‡å®¢è£½åŒ–é£²å“åŠ å…¥è³¼ç‰©è»Š ---
function finalAddToCart(event) {
    event.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­æäº¤è¡Œç‚º
    
    // ç²å–æ‰€æœ‰é¸ä¸­çš„é¸é …
    const sweetness = form.querySelector('input[name="sweetness"]:checked');
    const ice = form.querySelector('input[name="ice"]:checked');
    const selectedToppings = Array.from(form.querySelectorAll('input[name="toppings"]:checked')).map(cb => cb.parentNode.textContent.trim());

    if (!sweetness || !ice) {
        alert('è«‹é¸æ“‡ç”œåº¦å’Œå†°å¡Šï¼');
        return;
    }

    const toppingLabel = selectedToppings.length > 0 ? `åŠ ${selectedToppings.join(', ')}` : 'ä¸åŠ æ–™';
    
    // è¨ˆç®—æœ€çµ‚åƒ¹æ ¼
    let toppingPrice = 0;
    form.querySelectorAll('input[name="toppings"]:checked').forEach(checkbox => {
        toppingPrice += parseInt(checkbox.getAttribute('data-price'));
    });
    const finalPricePerUnit = currentBasePrice + toppingPrice;


    // å»ºç«‹è³¼ç‰©è»Šé …ç›®
    const cartItem = {
        // ä½¿ç”¨ Date.now() + éš¨æ©Ÿæ•¸ç¢ºä¿ ID å”¯ä¸€
        id: Date.now() + Math.floor(Math.random() * 1000), 
        menuId: currentItem.id,
        name: currentItem.name,
        price: finalPricePerUnit, // å­˜å„²å–®åƒ¹(å«åŠ æ–™)
        quantity: currentQty,     // <--- é€™è£¡ä½¿ç”¨é¸ä¸­çš„æ•¸é‡
        options: `${sweetness.parentNode.textContent.trim()} / ${ice.parentNode.textContent.trim()} / ${toppingLabel}`
    };

    // VVVV ä¿®æ­£éƒ¨åˆ†ï¼šç§»é™¤è¿´åœˆï¼Œåªå°‡å“é …åŠ å…¥ä¸€æ¬¡ VVVV
    cart.push(cartItem);
    // ^^^^ ä¿®æ­£éƒ¨åˆ† ^^^^
   
    updateCartCount();
    closeModal();
}

// --- å‡½å¼ï¼šåŸ·è¡Œè¨‚å–®æŸ¥è©¢ ---
async function handleOrderQuery() {
    const phoneSuffix = phoneQueryInput.value.trim();
    queryResultDiv.innerHTML = `<p class="text-indigo-500">æ­£åœ¨æŸ¥è©¢ä¸­...</p>`;

    if (phoneSuffix.length !== 3 || !/^\d{3}$/.test(phoneSuffix)) {
        queryResultDiv.innerHTML = `<p class="text-red-500">è«‹è¼¸å…¥æ­£ç¢ºçš„ 3 ä½æ•¸å­—æ‰‹æ©Ÿå¾Œä¸‰ç¢¼ï¼</p>`;
        return;
    }

    try {
        const response = await fetch(`http://127.0.0.1:5000/api/order/query?phone_suffix=${phoneSuffix}`);
        
        if (response.status === 404) {
             queryResultDiv.innerHTML = `<p class="text-red-500">æŸ¥ç„¡æ­¤è™Ÿç¢¼çš„è¨‚å–®è¨˜éŒ„ã€‚</p>`;
             return;
        }

        if (!response.ok) {
            throw new Error('ä¼ºæœå™¨éŒ¯èª¤æˆ–ç¶²è·¯ç•°å¸¸');
        }

        const orders = await response.json();
        renderQueryResult(orders);

    } catch (error) {
        console.error('æŸ¥è©¢è¨‚å–®ç™¼ç”ŸéŒ¯èª¤:', error);
        queryResultDiv.innerHTML = `<p class="text-red-500">æŸ¥è©¢å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–å¾Œç«¯æœå‹™æ˜¯å¦é‹è¡Œã€‚</p>`;
    }
}

// --- å‡½å¼ï¼šæ¸²æŸ“è¨‚å–®æŸ¥è©¢çµæœ ---
function renderQueryResult(orders) {
    if (orders.length === 0) {
        queryResultDiv.innerHTML = `<p class="text-red-500">æŸ¥ç„¡è¨‚å–®è¨˜éŒ„ã€‚</p>`;
        return;
    }
    
    let html = '<h3 class="font-bold text-lg border-b pb-2 mb-2">æ‚¨çš„è¨‚å–®è¨˜éŒ„:</h3>';
    
    orders.forEach(order => {

        const isDelivery = order.pickup_type === 'delivery';
        const typeText = isDelivery ? 
            `<span class="text-red-600 font-semibold">å¤–é€ (é‹è²»å·²è¨ˆ)</span>` : 
            `<span class="text-green-600 font-semibold">ç¾å ´å–é¤</span>`;
            
        const addressHtml = isDelivery && order.address ? 
            `<p class="ml-4 text-sm text-gray-700"><strong>å¤–é€åœ°å€:</strong> ${order.address}</p>` : 
            '';

        html += `
            <div class="bg-indigo-100 p-3 rounded-lg shadow-sm border-l-4 border-indigo-500 space-y-1">
                <p><strong>ç·¨è™Ÿ:</strong> <span class="text-indigo-800 font-semibold">${order.order_id}</span></p>
                <p><strong>å“é …:</strong> ${order.content}</p>
                <p><strong>ç¸½é¡:</strong> $${order.final_amount.toFixed(0)}</p>
                <p><strong>ä¸‹å–®:</strong> ${order.created_at}</p>
            </div>
        `;
    });
    
    queryResultDiv.innerHTML = html;
}


// --- å•Ÿå‹•åˆå§‹åŒ– ---
document.addEventListener('DOMContentLoaded', () => {
    // 1. åˆå§‹æ¸²æŸ“æ‰€æœ‰å•†å“ (æˆ–äººæ°£å¿…é»)
    renderMenu(menuItems.filter(item => item.isPopular));

    // 2. ç¶å®šé¡åˆ¥ç¯©é¸æŒ‰éˆ•äº‹ä»¶
    document.querySelectorAll('.category-btn').forEach(button => {
        button.addEventListener('click', handleCategoryFilter);
    });
    
    // 3. ç¶å®šè³¼ç‰©è»ŠæŒ‰éˆ•é»æ“Šäº‹ä»¶ (å°å‘çµå¸³é é¢)
    document.getElementById('cart-float-btn').addEventListener('click', () => {
        if (cart.length === 0) {
            alert('æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå¿«å»é»é¤å§ï¼');
        } else {
            localStorage.setItem('currentCart', JSON.stringify(cart));
            window.location.href = 'checkout.html';
        }
    });

    // 4. ç¶å®šæœå°‹è¼¸å…¥äº‹ä»¶
    searchInput.addEventListener('input', handleSearch);

    // 5. ç¶å®š Modal ç›¸é—œäº‹ä»¶ (ä¿®æ­£å¾Œçš„é‚è¼¯ï¼Œç¢ºä¿æ¯æ¬¡è¼‰å…¥éƒ½ç¶å®š)
    document.getElementById('close-modal-btn').addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
    document.getElementById('qty-minus').addEventListener('click', () => {
        if (currentQty > 1) {
            currentQty--;
            updateModalDisplay();
        }
    });
    document.getElementById('qty-plus').addEventListener('click', () => {
        currentQty++;
        updateModalDisplay();
    });
    form.addEventListener('submit', finalAddToCart);

    // 6. [æ–°å¢] ç¶å®šè¨‚å–®æŸ¥è©¢äº‹ä»¶
    queryOrderBtn.addEventListener('click', handleOrderQuery);
    // å…è¨±åœ¨è¼¸å…¥æ¡†æŒ‰ Enter éµæŸ¥è©¢
    phoneQueryInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­è¡Œç‚º
            handleOrderQuery();
        }
    });
});
    </script>

</body>
</html>